<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libparanut: libparanut Documentation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libparanut
   </div>
   <div id="projectbrief">A Hardware Abstraction Layer for ParaNut Architectures.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">libparanut Documentation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="ParaNut"></a>
Software Library Documentation</h1>
<p>Welcome to the libparanut documentation! This is a hardware abstraction library you can use to program a ParaNut processor without having to stare at Assembly Code. This documentation is meant as reference to developers interested in</p><ul>
<li>Developing software for a ParaNut processor.</li>
<li>Using the special concepts of parallelity in a ParaNut processor.</li>
<li>Improving the libparanut.</li>
</ul>
<p>The main docoumentation containing the definition of the ParaNut architecture and design rules can be found in the <a href="../../doc/paranut-manual.pdf"><em>ParaNut Manual</em></a>. If you want to work with the SystemC ParaNut model (simulation) take a look at the libparanutsim documentation <a href="../../doc/libparanutsim/index.html"><em>libparanutsim Documentation</em></a>.</p>
<h1><a class="anchor" id="modules"></a>
Modules of the libparanut</h1>
<p>The libparanut serves several functions to you on a silver platter. These are grouped into the <a class="el" href="group__mo.html">libparanut Modules</a> :</p>
<ol type="1">
<li>The <a class="el" href="group__ba.html">Base Module</a> contains functions for getting general information about the ParaNut, like the number of cores and such. There's also some functions for halting cores.</li>
<li>The <a class="el" href="group__li.html">Link Module</a> contains functions for stopping and starting Linked Mode execution. Don't know what that is? Check <a class="el" href="group__ms.html">Modes</a> or the fine ParaNut Manual.</li>
<li>The <a class="el" href="group__th.html">Thread Module</a> contains functions for stopping and starting Threaded Mode execution. Same advice goes.</li>
<li>The <a class="el" href="group__ca.html">Cache Module</a> contains functions for controlling the ParaNut cache and getting information about it.</li>
<li>The <a class="el" href="group__ex.html">Exception Module</a> contains functions for controlling Interrupts and Exceptions.</li>
<li>The <a class="el" href="group__sp.html">Spinlock Module</a> is an implementation of a spinlock so you can properly protect and synchronize your stuff in Threaded Mode.</li>
</ol>
<h1><a class="anchor" id="System"></a>
Overview</h1>
<p>The following picture shows a system overview. It might be a little confusing at first. Don't worry about that, just read some more documentation and it will probably all fall into place.</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000001">Todo:</a></b></dt><dd>Add English Version and fix format</dd></dl>
<div class="image">
<img src="aufbau.png" alt="" width="800px"/>
<div class="caption">
Overview of the libparanut</div></div>
 <h1><a class="anchor" id="HOWTO"></a>
HOWTO</h1>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000002">Todo:</a></b></dt><dd>Add documentation here in case other compilers/ISAs are used someday.</dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000003">Todo:</a></b></dt><dd>The <a class="el" href="Makefile.html">Makefile</a> might not be compliant with any other tool than GNU make.</dd></dl>
<p>How to make libparanut run with our in-house ParaNut implementation: You will need GNU make and the RISC-V GNU Toolchain for that (see Appendix A in ParaNut Manual). Also, you may need to have Python on your system (so far, no restrictions on the version are known). This assumes you already got the ParaNut up and running!</p>
<ol type="1">
<li>Open up the wonderful <a class="el" href="Makefile.html">Makefile</a> in the libparanut directory. This is the place where all your wishes come true. Right at the start, there's the section "System Configuration" where you can set a few things to tweek your libparanut. Check out the <a class="el" href="group__co.html">libparanut Compile Time Parameters</a> to see what those values mean. The default should be fine at first.</li>
<li>Onto the section "Compiler Configuration". See the "PN_ISA" in the <a class="el" href="Makefile.html">Makefile</a>? This is the Instruction Set Architecture. The very nice <a class="el" href="Makefile.html">Makefile</a> tree will chose all the right assembly source code files for the libparanut if this variable is set correctly. Currently, our ParaNut implements RISCV ISA, which is why this value says RV32I. This means you don't have to touch it.</li>
<li>The <a class="el" href="Makefile.html">Makefile</a> also lets you chose the compiler. If you want another compiler than GCC, you will also need to add some if-else logic in the section "Compiler and Assembler Flags".</li>
<li>To reduce the code size of the libparanut, you could set "PN_DEBUG" to 0. This means that the libparanut will not be compiled with debug symbols. It should be fine to compile it with debug symbols at first, though.</li>
<li>Want everything compiled now? Say<div class="fragment"><div class="line">gmake all </div>
</div><!-- fragment --> and the magic is done. All the modules are compiled and statically linked into "libparanut.a". You can find it in the newly generated directory named "INSTALL". Do not forget to call clean beforehand if you changed something in the Makefile.</li>
<li>Include paranut.h in your application. Set your include-path to the INSTALL directory while compiling: <div class="fragment"><div class="line">-I/path/to/libparanut/INSTALL/include </div>
</div><!-- fragment --></li>
<li>Link libparanut.a into your application. To do that in GCC, you can just put<div class="fragment"><div class="line">-L/path/to/libparanut/INSTALL/lib -lparanut </div>
</div><!-- fragment --> at the end of your linker/compilation command.</li>
</ol>
<p>I hope the following example can explain what I mean:</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000004">Todo:</a></b></dt><dd>Prettier example, explain Link Module and Spinlock Module.</dd></dl>
<div class="fragment"><div class="line">cd /path/to/libparanut</div>
<div class="line">gmake all</div>
<div class="line">cd /path/to/my_application.c</div>
<div class="line">my_gcc -c my_compiler_options -I/path/to/libparanut/INSTALL/include my_application.c</div>
<div class="line">my_gcc my_link_options my_object.o -L/path/to/libparanut/INSTALL/lib-lparanut</div>
</div><!-- fragment --><p>Do not forget to also compile in the startup code. To see a full example of what you need to do, check the Makefiles in the other sw/ subdirectories in the repository.</p>
<h1><a class="anchor" id="expectations"></a>
Expectations to the application</h1>
<p>Here is a list of things that the libparanut expects you to have done before using it:</p>
<ol type="1">
<li>The <a class="el" href="group__ca.html">Cache Module</a> expects you to have called <a class="el" href="group__ca.html#gaa344e348913381e60a0249ec7d076efd">pn_cache_init()</a> before using any of its other functions. Behaviour of the other functions is undefined if not.</li>
<li>The <a class="el" href="group__ex.html">Exception Module</a> expects you to have called <a class="el" href="group__ex.html#gadc3cc5948f345036b6f9f147cc7152b9">pn_exception_init()</a> before calling <a class="el" href="group__ex.html#ga2355303d91aaaf3576c0bcb5a0b22fe0">pn_exception_set_handler()</a>. I mean, you can set your own exception handler beforehand, but it will not be called if the exception occurs. The <a class="el" href="group__ex.html#ga77f7418a7e8917d550d2bd899486cd20">pn_interrupt_enable()</a>, <a class="el" href="group__ex.html#ga6bc2d22cf1580fee2349bdde5e34ebf0">pn_interrupt_disable()</a>, and <a class="el" href="group__ex.html#ga7f68555275f5163f8b406834de3ec80a">pn_progress_mepc()</a> functions will work with no problem, though.</li>
<li>The <a class="el" href="group__th.html">Thread Module</a> is the complicated one. It's a little tricky because of its workflow. The CePU internally sets a few needed variables which indicate a status to the CoPU. After a CoPU is woken up, they start executing code at the reset address. This means that the end of the startup code for the CoPUs also needs to be their entrance point to the <a class="el" href="group__th.html">Thread Module</a>, where they can read the internal variables and figure out what they are supposed to do with them. This entrance point is <a class="el" href="group__th.html#ga157c10cafb8d6c98626fd037a5ed56d3">pn_thread_entry()</a>, and it needs to be called in the startup code on all CoPUs. Our in-house startup code does this for you, but I'm leaving that here just in case you want to know.</li>
<li>The <a class="el" href="group__th.html">Thread Module</a> has one more expectation. The state of the CePU and its memory need to be shared with all cores. That means that there has to be a shared memory section that has to be as big as the memory for the individual cores. The start adress of this area has to be put into a globally known location called shared_mem_start, and the size has to be put into shared_mem_size. This also happens in our build-in startup code, so you do not need to worry about it.</li>
</ol>
<p>Also, here's some general advice: If you want your startup code to be compatible with many versions of the libparanut, you can check if a certain module is available. The file pn_config.h, which is created during compilation time, has some defines set for every module that is enabled. Check out the pn_config.h documentation to find out more!</p>
<h1><a class="anchor" id="future"></a>
Future Ideas for libparanut</h1>
<ol type="1">
<li>In the <a class="el" href="group__ca.html">Cache Module</a>, split <a class="el" href="group__ca.html#gaa3c03f9e7c5a2ce5590d7fcf44fe5f4b">pn_cache_enable()</a> and <a class="el" href="group__ca.html#ga167e721f4605eb0bbd9c41cd4600dc96">pn_cache_disable()</a> into seperate functions for data and instruction cache.</li>
<li>In the <a class="el" href="group__th.html">Thread Module</a>, build in POSIX style thread functions.</li>
<li>Build a state machine for every core that tracks wether a core is used in linked mode, threaded mode, or doing POSIX threads. Enable the user of the libparanut to use threaded and linked mode in a mixed way.</li>
<li>In <a class="el" href="group__ex.html">Exception Module</a>, provide a function to hang in a "raw" exception handler (basically change mtvec).</li>
<li>Implement a possibility to check wether or not a module has been initialized already. Also implement a pn_init() function which checks for all modules if the module is already initialized, and if it is not, initializes them (provided the module was compiled in).</li>
<li>Concerning the init() functions: If a function in a module is used despite of the module not being initialized, throw an exception (use <a class="el" href="group__ex.html#gaf7949ec28da99ddbfe629d6069ed8ec7">pn_ecall()</a>).</li>
<li>Implement a pn_strerror() function which takes an error value and prints what the error means.</li>
<li>Implement a global checkable error variable.</li>
<li>For threaded and linked mode, implement the possibility to pass a stack size that shall be copied. It should also be able to tell these functions that only the stack from the top function shall be copied.</li>
<li>Implement a pn_atomic_increment() and pn_atomic_decrement() function.</li>
<li>Implement pn_printf() which can be used in linked mode.</li>
<li>In the Makefile, copy the libparanut to the place where the RISCV toolchain is installed. This would make it easier for applications to compile.</li>
</ol>
<h1><a class="anchor" id="Copyright"></a>
Copyright</h1>
<p>Copyright 2019-2020 Anna Pfuetzner (<a href="#" onclick="location.href='mai'+'lto:'+'ann'+'ak'+'ers'+'ti'+'n.p'+'fu'+'etz'+'ne'+'r@g'+'ma'+'il.'+'co'+'m'; return false;">annak<span style="display: none;">.nosp@m.</span>erst<span style="display: none;">.nosp@m.</span>in.pf<span style="display: none;">.nosp@m.</span>uetz<span style="display: none;">.nosp@m.</span>ner@g<span style="display: none;">.nosp@m.</span>mail<span style="display: none;">.nosp@m.</span>.com</a>) Alexander Bahle (<a href="#" onclick="location.href='mai'+'lto:'+'ale'+'xa'+'nde'+'r.'+'bah'+'le'+'@hs'+'-a'+'ugs'+'bu'+'rg.'+'de'; return false;">alexa<span style="display: none;">.nosp@m.</span>nder<span style="display: none;">.nosp@m.</span>.bahl<span style="display: none;">.nosp@m.</span>e@hs<span style="display: none;">.nosp@m.</span>-augs<span style="display: none;">.nosp@m.</span>burg<span style="display: none;">.nosp@m.</span>.de</a>)</p>
<p>Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</p>
<ol type="1">
<li>Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</li>
<li>Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</li>
</ol>
<p>THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
